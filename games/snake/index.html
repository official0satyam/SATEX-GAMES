<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Snake Evolution | ArcadeVerse</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../../core/styles.css">
    <style>
        canvas {
            background: #fff;
            border: 4px solid #212529;
            box-shadow: 10px 10px 0px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>

<body>
    <div class="game-shell">
        <div class="game-area" id="gameContainer">
            <canvas id="gameCanvas"></canvas>

            <div class="hud-overlay">
                <div class="hud-stat">
                    <span class="hud-stat-label">Score</span>
                    <span id="score" class="hud-stat-value">0</span>
                </div>
                <div class="hud-stat">
                    <span class="hud-stat-label">Best</span>
                    <span id="highscore" class="hud-stat-value">0</span>
                </div>
            </div>

            <div id="messageBox" class="game-overlay-panel">
                <h1 class="overlay-title">READY?</h1>
                <button id="startBtn" class="btn-cartoon">START GAME</button>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const scoreElement = document.getElementById('score');
        const highscoreElement = document.getElementById('highscore');
        const messageBox = document.getElementById('messageBox');
        const startBtn = document.getElementById('startBtn');

        const gridSize = 20;
        let snake = [];
        let food = {};
        let direction = 'right';
        let nextDirection = 'right';
        let score = 0;
        let highscore = localStorage.getItem('arcadeverse_snake_highscore') || 0;
        let gameActive = false;
        let gameLoop;

        highscoreElement.textContent = highscore;

        function resizeCanvas() {
            const container = document.getElementById('gameContainer');
            const size = Math.min(container.clientWidth - 60, container.clientHeight - 60, 500);
            canvas.width = size - (size % gridSize);
            canvas.height = size - (size % gridSize);
            if (!gameActive) draw();
        }

        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();

        function initGame() {
            snake = [{ x: 5, y: 10 }, { x: 4, y: 10 }, { x: 3, y: 10 }];
            direction = 'right';
            nextDirection = 'right';
            score = 0;
            scoreElement.textContent = score;
            generateFood();
        }

        function generateFood() {
            food = {
                x: Math.floor(Math.random() * (canvas.width / gridSize)),
                y: Math.floor(Math.random() * (canvas.height / gridSize))
            };
            for (let part of snake) {
                if (part.x === food.x && part.y === food.y) generateFood();
            }
        }

        function draw() {
            ctx.fillStyle = '#f8f9fa';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Grid
            ctx.strokeStyle = '#e9ecef';
            ctx.lineWidth = 1;
            for (let i = 0; i <= canvas.width; i += gridSize) {
                ctx.beginPath(); ctx.moveTo(i, 0); ctx.lineTo(i, canvas.height); ctx.stroke();
                ctx.beginPath(); ctx.moveTo(0, i); ctx.lineTo(canvas.width, i); ctx.stroke();
            }

            // Food (Red Apple)
            ctx.fillStyle = '#FF6B6B';
            ctx.beginPath();
            ctx.arc(food.x * gridSize + gridSize / 2, food.y * gridSize + gridSize / 2, gridSize / 2 - 2, 0, Math.PI * 2);
            ctx.fill();

            // Snake (Green)
            snake.forEach((part, index) => {
                ctx.fillStyle = index === 0 ? '#4CAF50' : '#81C784';
                ctx.fillRect(part.x * gridSize + 1, part.y * gridSize + 1, gridSize - 2, gridSize - 2);
            });
        }

        function update() {
            direction = nextDirection;
            const head = { x: snake[0].x, y: snake[0].y };
            if (direction === 'right') head.x++;
            if (direction === 'left') head.x--;
            if (direction === 'up') head.y--;
            if (direction === 'down') head.y++;

            if (head.x < 0 || head.x >= canvas.width / gridSize || head.y < 0 || head.y >= canvas.height / gridSize ||
                snake.some((part, i) => i !== 0 && part.x === head.x && part.y === head.y)) {
                gameOver();
                return;
            }

            snake.unshift(head);
            if (head.x === food.x && head.y === food.y) {
                score += 10;
                scoreElement.textContent = score;
                if (score > highscore) {
                    highscore = score;
                    highscoreElement.textContent = highscore;
                    localStorage.setItem('arcadeverse_snake_highscore', highscore);
                }
                generateFood();
            } else {
                snake.pop();
            }
        }

        function gameStep() {
            update();
            draw();
        }

        function startGame() {
            initGame();
            gameActive = true;
            messageBox.style.display = 'none';
            if (gameLoop) clearInterval(gameLoop);
            gameLoop = setInterval(gameStep, 100);
        }

        function gameOver() {
            gameActive = false;
            clearInterval(gameLoop);
            messageBox.style.display = 'flex';
            messageBox.innerHTML = `<h1 class="overlay-title" style="color: #FF6B6B">GAME OVER</h1>
                <p style="font-size: 1.5rem; margin-bottom: 25px; font-weight: 700;">Final Score: ${score}</p>
                <button onclick="startGame()" class="btn-cartoon">TRY AGAIN</button>`;
        }

        startBtn.addEventListener('click', startGame);
        window.addEventListener('keydown', e => {
            if (['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight', 'w', 'a', 's', 'd'].includes(e.key)) e.preventDefault();
            if (e.key === 'ArrowUp' || e.key === 'w') if (direction !== 'down') nextDirection = 'up';
            if (e.key === 'ArrowDown' || e.key === 's') if (direction !== 'up') nextDirection = 'down';
            if (e.key === 'ArrowLeft' || e.key === 'a') if (direction !== 'right') nextDirection = 'left';
            if (e.key === 'ArrowRight' || e.key === 'd') if (direction !== 'left') nextDirection = 'right';
        });
        draw();
    </script>
</body>

</html>